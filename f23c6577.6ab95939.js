(window.webpackJsonp=window.webpackJsonp||[]).push([[80],{145:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return i})),t.d(n,"metadata",(function(){return c})),t.d(n,"toc",(function(){return s})),t.d(n,"default",(function(){return p}));var r=t(3),o=t(7),a=(t(0),t(154)),i={title:"MockEnvironment"},c={unversionedId:"api/mock-environment",id:"version-1.0.0/api/mock-environment",isDocsHomePage:!1,title:"MockEnvironment",description:"`swift",source:"@site/versioned_docs/version-1.0.0/api/mock-environment.md",slug:"/api/mock-environment",permalink:"/Relay.swift/docs/api/mock-environment",editUrl:"https://github.com/relay-tools/Relay.swift/edit/main/website/versioned_docs/version-1.0.0/api/mock-environment.md",version:"1.0.0",sidebar:"version-1.0.0/docs",previous:{title:"ConnectionHandler",permalink:"/Relay.swift/docs/api/connection-handler"},next:{title:"Introduction",permalink:"/Relay.swift/docs/api/intro-relay-swift-ui"}},s=[{value:"Creating a mock environment",id:"creating-a-mock-environment",children:[{value:"<code>init</code>",id:"init",children:[]}]},{value:"Loading data into the store",id:"loading-data-into-the-store",children:[{value:"<code>cachePayload(_:_:)</code>",id:"cachepayload__",children:[]}]},{value:"Faking network responses",id:"faking-network-responses",children:[{value:"<code>mockResponse(_:_:)</code>",id:"mockresponse__",children:[]},{value:"<code>delayMockedResponse(_:_:)</code>",id:"delaymockedresponse__",children:[]}]}],l={toc:s};function p(e){var n=e.components,t=Object(o.a)(e,["components"]);return Object(a.b)("wrapper",Object(r.a)({},l,t,{components:n,mdxType:"MDXLayout"}),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-swift"},"class MockEnvironment: Environment\n")),Object(a.b)("p",null,"A ",Object(a.b)("inlineCode",{parentName:"p"},"MockEnvironment")," is a special ",Object(a.b)("a",{parentName:"p",href:"/Relay.swift/docs/api/environment"},"Environment")," subclass that has special support injecting data into the store and faking network responses. A mock environment is intended to be used for things like unit tests or SwiftUI previews (see ",Object(a.b)("a",{parentName:"p",href:"/Relay.swift/docs/api/preview-payload"},"previewPayload()")," for the latter)."),Object(a.b)("h2",{id:"creating-a-mock-environment"},"Creating a mock environment"),Object(a.b)("h3",{id:"init"},Object(a.b)("inlineCode",{parentName:"h3"},"init")),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-swift"},"init(\n  handlerProvider: HandlerProvider = DefaultHandlerProvider()\n)\n")),Object(a.b)("p",null,"You don't need to pass a ",Object(a.b)("a",{parentName:"p",href:"/Relay.swift/docs/api/network"},"network layer")," or ",Object(a.b)("a",{parentName:"p",href:"/Relay.swift/docs/api/store"},"store")," when creating a mock environment. A mock environment always starts with an empty store, and it includes a special network layer intended for mocking."),Object(a.b)("h2",{id:"loading-data-into-the-store"},"Loading data into the store"),Object(a.b)("h3",{id:"cachepayload__"},Object(a.b)("inlineCode",{parentName:"h3"},"cachePayload(_:_:)")),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-swift"},"func cachePayload<O: Operation>(\n  _ operation: O,\n  _ payload: [String: Any]\n)\n")),Object(a.b)("p",null,"The ",Object(a.b)("inlineCode",{parentName:"p"},"cachePayload")," method loads a response to a particular query directly into the store. This doesn't use the ",Object(a.b)("a",{parentName:"p",href:"/Relay.swift/docs/api/network"},"network layer")," layer at all. This works well when you need to read a fragment from the store."),Object(a.b)("p",null,"Note that even if you just want to read a fragment, you still need to have a query that includes it, and you need to supply a payload for the entire query. This is because queries are what determine how data gets normalized into the store: a fragment alone doesn't have enough information to write its data, only to read it."),Object(a.b)("h2",{id:"faking-network-responses"},"Faking network responses"),Object(a.b)("h3",{id:"mockresponse__"},Object(a.b)("inlineCode",{parentName:"h3"},"mockResponse(_:_:)")),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-swift"},"func mockResponse<O: Operation>(\n  _ operation: O,\n  _ payload: [String: Any]\n)\n")),Object(a.b)("p",null,"The ",Object(a.b)("inlineCode",{parentName:"p"},"mockResponse")," method stores a payload to be returned from the network layer when something tries to execute the given operation. For example, if you're testing a view that uses a ",Object(a.b)("a",{parentName:"p",href:"/Relay.swift/docs/api/query"},"@Query"),", you can use this to set up the response to the query before rendering the view."),Object(a.b)("p",null,"To use the response, the operation must be for the same query with the same variables."),Object(a.b)("h3",{id:"delaymockedresponse__"},Object(a.b)("inlineCode",{parentName:"h3"},"delayMockedResponse(_:_:)")),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-swift"},"func delayMockedResponse<O: Operation>(\n  _ operation: O,\n  _ payload: [String: Any]\n) -> (() -> Void)\n")),Object(a.b)("p",null,"The ",Object(a.b)("inlineCode",{parentName:"p"},"delayMockedResponse")," is similar to ",Object(a.b)("inlineCode",{parentName:"p"},"mockResponse"),", but it gives you control over when the fake network response is returned to Relay. It returns an ",Object(a.b)("inlineCode",{parentName:"p"},"advance")," function that your code can call when it wants the fake network response to complete. Until the ",Object(a.b)("inlineCode",{parentName:"p"},"advance")," function is called, the network response will be in-flight."))}p.isMDXComponent=!0},154:function(e,n,t){"use strict";t.d(n,"a",(function(){return d})),t.d(n,"b",(function(){return b}));var r=t(0),o=t.n(r);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function c(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var l=o.a.createContext({}),p=function(e){var n=o.a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):c(c({},n),e)),t},d=function(e){var n=p(e.components);return o.a.createElement(l.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return o.a.createElement(o.a.Fragment,{},n)}},m=o.a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,a=e.originalType,i=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),d=p(t),m=r,b=d["".concat(i,".").concat(m)]||d[m]||u[m]||a;return t?o.a.createElement(b,c(c({ref:n},l),{},{components:t})):o.a.createElement(b,c({ref:n},l))}));function b(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var a=t.length,i=new Array(a);i[0]=m;var c={};for(var s in n)hasOwnProperty.call(n,s)&&(c[s]=n[s]);c.originalType=e,c.mdxType="string"==typeof e?e:r,i[1]=c;for(var l=2;l<a;l++)i[l]=t[l];return o.a.createElement.apply(null,i)}return o.a.createElement.apply(null,t)}m.displayName="MDXCreateElement"}}]);