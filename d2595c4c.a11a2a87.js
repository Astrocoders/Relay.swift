(window.webpackJsonp=window.webpackJsonp||[]).push([[70],{135:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return a})),t.d(n,"metadata",(function(){return c})),t.d(n,"toc",(function(){return d})),t.d(n,"default",(function(){return b}));var o=t(3),r=t(7),i=(t(0),t(154)),a={title:"ConnectionHandler"},c={unversionedId:"api/connection-handler",id:"version-1.0.0/api/connection-handler",isDocsHomePage:!1,title:"ConnectionHandler",description:"`swift",source:"@site/versioned_docs/version-1.0.0/api/connection-handler.md",slug:"/api/connection-handler",permalink:"/Relay.swift/docs/api/connection-handler",editUrl:"https://github.com/relay-tools/Relay.swift/edit/main/website/versioned_docs/version-1.0.0/api/connection-handler.md",version:"1.0.0",sidebar:"version-1.0.0/docs",previous:{title:"RecordProxy",permalink:"/Relay.swift/docs/api/record-proxy"},next:{title:"MockEnvironment",permalink:"/Relay.swift/docs/api/mock-environment"}},d=[{value:"Using the default handler",id:"using-the-default-handler",children:[]},{value:"Getting the connection record",id:"getting-the-connection-record",children:[{value:"<code>getConnection(_:key:filters:)</code>",id:"getconnection_keyfilters",children:[]}]},{value:"Inserting edges into the connection",id:"inserting-edges-into-the-connection",children:[{value:"<code>createEdge(_:connection:node:type:)</code>",id:"createedge_connectionnodetype",children:[]},{value:"<code>insert(connection:edge:before:)</code>",id:"insertconnectionedgebefore",children:[]},{value:"<code>insert(connection:edge:after:)</code>",id:"insertconnectionedgeafter",children:[]}]},{value:"Deleting edges from the connection",id:"deleting-edges-from-the-connection",children:[{value:"<code>delete(connection:nodeID:)</code>",id:"deleteconnectionnodeid",children:[]}]}],l={toc:d};function b(e){var n=e.components,t=Object(r.a)(e,["components"]);return Object(i.b)("wrapper",Object(o.a)({},l,t,{components:n,mdxType:"MDXLayout"}),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-swift"},"class ConnectionHandler: Handler\n")),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"ConnectionHandler")," implements the special logic to handle storing fields tagged with the ",Object(i.b)("inlineCode",{parentName:"p"},"@connection")," directive. These fields are most commonly used with ",Object(i.b)("a",{parentName:"p",href:"/Relay.swift/docs/api/pagination-fragment"},"@PaginationFragment"),"s. The default ",Object(i.b)("inlineCode",{parentName:"p"},"HandlerProvider")," for an environment already includes the ",Object(i.b)("inlineCode",{parentName:"p"},"ConnectionHandler"),", so for the most part, this works out-of-the-box. "),Object(i.b)("p",null,"If you have mutations that want to use ",Object(i.b)("inlineCode",{parentName:"p"},"updater")," functions to change the lists of edges for your connections, ",Object(i.b)("inlineCode",{parentName:"p"},"ConnectionHandler")," exposes some methods that will make those operations much easier."),Object(i.b)("h2",{id:"using-the-default-handler"},"Using the default handler"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-swift"},"static let default = ConnectionHandler()\n")),Object(i.b)("p",null,"The default connection handler is available as ",Object(i.b)("inlineCode",{parentName:"p"},"ConnectionHandler.default"),"."),Object(i.b)("h2",{id:"getting-the-connection-record"},"Getting the connection record"),Object(i.b)("h3",{id:"getconnection_keyfilters"},Object(i.b)("inlineCode",{parentName:"h3"},"getConnection(_:key:filters:)")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-swift"},"func getConnection(\n  _ record: RecordProxy,\n  key: String,\n  filters: VariableDataConvertible? = nil\n) -> RecordProxy?\n")),Object(i.b)("p",null,"Normally, you would use the ",Object(i.b)("inlineCode",{parentName:"p"},"getLinkedField")," on a ",Object(i.b)("a",{parentName:"p",href:"/Relay.swift/docs/api/record-proxy"},"RecordProxy")," to get the record for a field, but connections are stored under a special key to correctly handle the way their arguments change as you are paging through the results. To access the connection field, you can traverse to its parent record and then use ",Object(i.b)("inlineCode",{parentName:"p"},"getConnection")," to get it from the correct key."),Object(i.b)("h4",{id:"parameters"},"Parameters"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"record"),": The parent record that contains the connection field"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"key"),": The ",Object(i.b)("inlineCode",{parentName:"li"},"key")," that you specified in the ",Object(i.b)("inlineCode",{parentName:"li"},"@connection")," directive on the field"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"filters"),": The non-paging arguments (or filters) for the connection. These keys should have been passed as ",Object(i.b)("inlineCode",{parentName:"li"},"filters")," in the ",Object(i.b)("inlineCode",{parentName:"li"},"@connection")," directive on the field.")),Object(i.b)("h2",{id:"inserting-edges-into-the-connection"},"Inserting edges into the connection"),Object(i.b)("h3",{id:"createedge_connectionnodetype"},Object(i.b)("inlineCode",{parentName:"h3"},"createEdge(_:connection:node:type:)")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-swift"},"func createEdge(\n  _ store: inout RecordSourceProxy,\n  connection: RecordProxy,\n  node: RecordProxy,\n  type edgeType: String\n) -> RecordProxy\n")),Object(i.b)("p",null,"Sometimes you'll have record for a node that you want to add to a connection, but you won't have an edge record for it. You can use ",Object(i.b)("inlineCode",{parentName:"p"},"createEdge")," to create that record, which you'll later be able to insert into the connection."),Object(i.b)("p",null,"This may not always create a new record. If the connection already has an edge for the node, that edge will be returned instead."),Object(i.b)("h4",{id:"parameters-1"},"Parameters"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"store"),": The store that you are adding the edge to. This will be passed in as an argument to your updater function."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"connection"),": The record for the connection to add the edge to. Note that this method doesn't update the connection record. Use ",Object(i.b)("inlineCode",{parentName:"li"},"getConnection")," to get this record."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"node"),": The node that the edge will contain. The ",Object(i.b)("inlineCode",{parentName:"li"},"node")," field on the returned edge will be this node."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"edgeType"),": The GraphQL type name for the created edge record.")),Object(i.b)("h3",{id:"insertconnectionedgebefore"},Object(i.b)("inlineCode",{parentName:"h3"},"insert(connection:edge:before:)")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-swift"},"func insert(\n  connection: inout RecordProxy,\n  edge newEdge: RecordProxy,\n  before cursor: String?\n)\n")),Object(i.b)("p",null,"Inserts an edge record before a particular edge in the connection, or at the beginning of the list."),Object(i.b)("h4",{id:"parameters-2"},"Parameters"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"connection"),": The record for the connection to add the edge to. Use ",Object(i.b)("inlineCode",{parentName:"li"},"getConnection")," to get this record."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"newEdge"),": The edge record to add to the connection. Use ",Object(i.b)("inlineCode",{parentName:"li"},"createEdge")," to create this record if your mutation response isn't already returning an edge record."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"cursor"),": The value of the ",Object(i.b)("inlineCode",{parentName:"li"},"cursor")," field of the edge that should come after this one. Pass ",Object(i.b)("inlineCode",{parentName:"li"},"nil")," to insert the new edge at the beginning of the list of edges.")),Object(i.b)("h3",{id:"insertconnectionedgeafter"},Object(i.b)("inlineCode",{parentName:"h3"},"insert(connection:edge:after:)")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-swift"},"func insert(\n  connection: inout RecordProxy,\n  edge newEdge: RecordProxy,\n  after cursor: String?\n)\n")),Object(i.b)("p",null,"Inserts an edge record after a particular edge in the connection, or at the end of the list."),Object(i.b)("h4",{id:"parameters-3"},"Parameters"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"connection"),": The record for the connection to add the edge to. Use ",Object(i.b)("inlineCode",{parentName:"li"},"getConnection")," to get this record."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"newEdge"),": The edge record to add to the connection. Use ",Object(i.b)("inlineCode",{parentName:"li"},"createEdge")," to create this record if your mutation response isn't already returning an edge record."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"cursor"),": The value of the ",Object(i.b)("inlineCode",{parentName:"li"},"cursor")," field of the edge that should come before this one. Pass ",Object(i.b)("inlineCode",{parentName:"li"},"nil")," to insert the new edge at the end of the list of edges.")),Object(i.b)("h2",{id:"deleting-edges-from-the-connection"},"Deleting edges from the connection"),Object(i.b)("h3",{id:"deleteconnectionnodeid"},Object(i.b)("inlineCode",{parentName:"h3"},"delete(connection:nodeID:)")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-swift"},"func delete(\n  connection: inout RecordProxy,\n  nodeID: DataID\n)\n")),Object(i.b)("p",null,"Removes any edges from the connection where the edge's node has the given ID."),Object(i.b)("p",null,"This doesn't delete the edge or node records from the store, though they may get garbage-collected if they are no longer referenced elsewhere."),Object(i.b)("h4",{id:"parameters-4"},"Parameters"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"connection"),": The record for the connection to add the edge to. Use ",Object(i.b)("inlineCode",{parentName:"li"},"getConnection")," to get this record."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"nodeID"),": The ID of the node whose edge should be removed from the connection.")))}b.isMDXComponent=!0},154:function(e,n,t){"use strict";t.d(n,"a",(function(){return s})),t.d(n,"b",(function(){return u}));var o=t(0),r=t.n(o);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function c(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function d(e,n){if(null==e)return{};var t,o,r=function(e,n){if(null==e)return{};var t,o,r={},i=Object.keys(e);for(o=0;o<i.length;o++)t=i[o],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)t=i[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var l=r.a.createContext({}),b=function(e){var n=r.a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):c(c({},n),e)),t},s=function(e){var n=b(e.components);return r.a.createElement(l.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return r.a.createElement(r.a.Fragment,{},n)}},h=r.a.forwardRef((function(e,n){var t=e.components,o=e.mdxType,i=e.originalType,a=e.parentName,l=d(e,["components","mdxType","originalType","parentName"]),s=b(t),h=o,u=s["".concat(a,".").concat(h)]||s[h]||p[h]||i;return t?r.a.createElement(u,c(c({ref:n},l),{},{components:t})):r.a.createElement(u,c({ref:n},l))}));function u(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var i=t.length,a=new Array(i);a[0]=h;var c={};for(var d in n)hasOwnProperty.call(n,d)&&(c[d]=n[d]);c.originalType=e,c.mdxType="string"==typeof e?e:o,a[1]=c;for(var l=2;l<i;l++)a[l]=t[l];return r.a.createElement.apply(null,a)}return r.a.createElement.apply(null,t)}h.displayName="MDXCreateElement"}}]);