<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/Relay.swift/releases/rss.xml" title="Relay.swift Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/Relay.swift/releases/atom.xml" title="Relay.swift Blog Atom Feed"><title data-react-helmet="true">Fetching data with queries | Relay.swift</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Fetching data with queries | Relay.swift"><meta data-react-helmet="true" name="description" content="Now that we&#x27;ve set up an environment, we can start fetching data and rendering it in our views. We&#x27;ll start with something simple"><meta data-react-helmet="true" property="og:description" content="Now that we&#x27;ve set up an environment, we can start fetching data and rendering it in our views. We&#x27;ll start with something simple"><meta data-react-helmet="true" property="og:url" content="https://relay-tools.github.io/Relay.swift/docs/getting-started/fetching-data"><link data-react-helmet="true" rel="shortcut icon" href="/Relay.swift/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://relay-tools.github.io/Relay.swift/docs/getting-started/fetching-data"><link rel="stylesheet" href="/Relay.swift/styles.62dfcd7f.css">
<link rel="preload" href="/Relay.swift/styles.d07b0fc4.js" as="script">
<link rel="preload" href="/Relay.swift/runtime~main.a771f272.js" as="script">
<link rel="preload" href="/Relay.swift/main.363275a7.js" as="script">
<link rel="preload" href="/Relay.swift/1.b36227a4.js" as="script">
<link rel="preload" href="/Relay.swift/54.e4415d89.js" as="script">
<link rel="preload" href="/Relay.swift/55.3f051518.js" as="script">
<link rel="preload" href="/Relay.swift/935f2afb.a68bbdd6.js" as="script">
<link rel="preload" href="/Relay.swift/53.aa06a7e1.js" as="script">
<link rel="preload" href="/Relay.swift/e4265c22.82f1470f.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/Relay.swift/"><strong class="navbar__title">Relay.swift</strong></a><a class="navbar__item navbar__link navbar__link--active" href="/Relay.swift/docs/">Docs</a><a class="navbar__item navbar__link" href="/Relay.swift/docs/knowledge-base">Knowledge base</a><a class="navbar__item navbar__link" href="/Relay.swift/releases/">Releases</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/relay-tools/Relay.swift" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/Relay.swift/"><strong class="navbar__title">Relay.swift</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link navbar__link--active" href="/Relay.swift/docs/">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/Relay.swift/docs/knowledge-base">Knowledge base</a></li><li class="menu__list-item"><a class="menu__link" href="/Relay.swift/releases/">Releases</a></li><li class="menu__list-item"><a href="https://github.com/relay-tools/Relay.swift" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/Relay.swift/docs/">Relay.swift</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Getting started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Relay.swift/docs/getting-started/installation">Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Relay.swift/docs/getting-started/relay-environment">The Relay environment</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/Relay.swift/docs/getting-started/fetching-data">Fetching data with queries</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Relay.swift/docs/getting-started/fragments">Composing views with fragments</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Relay.swift/docs/getting-started/mutations">Making changes with mutations</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">API reference</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Relay.swift</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/api/intro-relay">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/api/graphql">GraphQL tagged strings</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/api/environment">Environment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/api/network">Network layer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/api/store">Store</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/api/record-source-selector-proxy">RecordSourceSelectorProxy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/api/record-proxy">RecordProxy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/api/connection-handler">ConnectionHandler</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/api/mock-environment">MockEnvironment</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Relay in SwiftUI</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/api/intro-relay-swift-ui">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/api/relay-environment-modifier">relayEnvironment()</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/api/relay-environment-wrapper">@RelayEnvironment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/api/query">@Query</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/api/fragment">@Fragment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/api/refetchable-fragment">@RefetchableFragment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/api/pagination-fragment">@PaginationFragment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/api/mutation">@Mutation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/api/preview-payload">previewPayload()</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Development</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/development/contributing">Contributing</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">Fetching data with queries</h1></header><div class="markdown"><p>Now that we&#x27;ve set up an environment, we can start fetching data and rendering it in our views. We&#x27;ll start with something simple: just rendering the ID of the current user. The first thing we want to do is write our GraphQL query into our view&#x27;s source file, <code>UserView.swift</code>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-swift codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">import SwiftUI</span></div><div class="token-line" style="color:#393A34"><span class="token plain">import RelaySwiftUI</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">private let query = graphql(&quot;&quot;&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">query UserViewQuery {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  viewer {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    id</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div><div class="token-line" style="color:#393A34"><span class="token plain">&quot;&quot;&quot;)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The <code>graphql</code> function doesn&#x27;t do anything in our Swift code, but it&#x27;s a marker that allows the Relay compiler to find our queries and generate code and types for them. Let&#x27;s generate those now:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">$ npx relay-compiler</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The compiler should create a file at <code>__generated__/UserViewQuery.graphql.swift</code>. We must add the new file to our Xcode project so it gets built into our app. This file contains types that help Relay execute the query and that allow our view to read the data it returns.</p><p>Now we can use our query in a SwiftUI view:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-swift codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">import SwiftUI</span></div><div class="token-line" style="color:#393A34"><span class="token plain">import RelaySwiftUI</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">private let query = graphql(&quot;&quot;&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">query UserViewQuery {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  viewer {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    id</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div><div class="token-line" style="color:#393A34"><span class="token plain">&quot;&quot;&quot;)</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">struct UserView: View {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    @Query&lt;UserViewQuery&gt; var query</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    var body: some View {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        switch query.get() {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        case .loading:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            Text(&quot;Loading...&quot;)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        case .failure(let error):</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            Text(&quot;Error: \(error.localizedDescription)&quot;)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        case .success(let data):</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            Text(&quot;User ID: \(data?.viewer?.id ?? &quot;none&quot;)&quot;)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>We&#x27;re using the <a href="/Relay.swift/docs/api/query">@Query</a> property wrapper provided by Relay.swift to load this data in our view. When we try to render the first time, the query will start loading its data and will return <code>.loading</code> from <code>query.get()</code>. Once the request has finished, our view will re-render its body with either <code>.failure</code> or <code>.success</code> as the result.</p><p>The <code>data</code> in the <code>.success</code> result has the type <code>UserViewQuery.Data?</code>. This structure is generated by the Relay compiler using our GraphQL schema to match the exact shape of the data requested by our query. We get automatic type-safe access to our data without having to write any serialization code.</p><p>This is great: we&#x27;re able to declare what data our view needs as well as what the view should look like in each possible state for fetching that data.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="dynamic-queries-using-variables"></a>Dynamic queries using variables<a class="hash-link" href="#dynamic-queries-using-variables" title="Direct link to heading">#</a></h2><p>Suppose we wanted to show information about other users, not just the current one. We can write a query that asks for the node with a given ID, and have our view take that ID in its initializer:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-swift codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">import SwiftUI</span></div><div class="token-line" style="color:#393A34"><span class="token plain">import RelaySwiftUI</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">private let query = graphql(&quot;&quot;&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">query UserViewQuery($userID: ID!) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  node(id: $userID) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    id</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div><div class="token-line" style="color:#393A34"><span class="token plain">&quot;&quot;&quot;)</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">struct UserView: View {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    @Query&lt;UserViewQuery&gt; var query</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    let id: String</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    var body: some View {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        switch query.get(userID: id) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        case .loading:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            Text(&quot;Loading...&quot;)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        case .failure(let error):</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            Text(&quot;Error: \(error.localizedDescription)&quot;)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        case .success(let data):</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            Text(&quot;User ID: \(data?.viewer?.id ?? &quot;none&quot;)&quot;)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>That&#x27;s a pretty small change from what we had before. Now our GraphQL query takes in a variable called <code>userID</code>. Because we changed the query, we need to run <code>npx relay-compiler</code> to regenerate the corresponding Swift types.</p><p>The Relay compiler generated a new variant of <code>query.get</code> for us that matches the variables we declared in our GraphQL query. When we render our view, we pass in the variables we want the query to use. In this case, we get the value for the <code>userID</code> variable as input to our view when it&#x27;s initialized, but you can also use <code>@State</code> properties or other ways that SwiftUI has to keep track of data.</p><p>You can learn more about using queries in the <a href="/Relay.swift/docs/api/query">@Query</a> API docs. For now, let&#x27;s see how to compose views together while loading data with Relay.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/relay-tools/Relay.swift/edit/main/website/docs/getting-started/fetching-data.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/Relay.swift/docs/getting-started/relay-environment"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« The Relay environment</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/Relay.swift/docs/getting-started/fragments"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Composing views with fragments Â»</div></a></div></nav></div></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Matt Moriarity.</div></div></div></footer></div>
<script src="/Relay.swift/styles.d07b0fc4.js"></script>
<script src="/Relay.swift/runtime~main.a771f272.js"></script>
<script src="/Relay.swift/main.363275a7.js"></script>
<script src="/Relay.swift/1.b36227a4.js"></script>
<script src="/Relay.swift/54.e4415d89.js"></script>
<script src="/Relay.swift/55.3f051518.js"></script>
<script src="/Relay.swift/935f2afb.a68bbdd6.js"></script>
<script src="/Relay.swift/53.aa06a7e1.js"></script>
<script src="/Relay.swift/e4265c22.82f1470f.js"></script>
</body>
</html>