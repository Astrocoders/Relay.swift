<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/Relay.swift/releases/rss.xml" title="Relay.swift Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/Relay.swift/releases/atom.xml" title="Relay.swift Blog Atom Feed"><title data-react-helmet="true">Composing views with fragments | Relay.swift</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="1.1.0"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-1.1.0"><meta data-react-helmet="true" property="og:title" content="Composing views with fragments | Relay.swift"><meta data-react-helmet="true" name="description" content="Let&#x27;s start building a real app. We&#x27;re going to show a to-do list using a table view, with each row being a single to-do item in the list."><meta data-react-helmet="true" property="og:description" content="Let&#x27;s start building a real app. We&#x27;re going to show a to-do list using a table view, with each row being a single to-do item in the list."><meta data-react-helmet="true" property="og:url" content="https://relay-tools.github.io/Relay.swift/docs/getting-started/fragments"><link data-react-helmet="true" rel="shortcut icon" href="/Relay.swift/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://relay-tools.github.io/Relay.swift/docs/getting-started/fragments"><link rel="stylesheet" href="/Relay.swift/styles.62dfcd7f.css">
<link rel="preload" href="/Relay.swift/styles.b64df67e.js" as="script">
<link rel="preload" href="/Relay.swift/runtime~main.dd5e0709.js" as="script">
<link rel="preload" href="/Relay.swift/main.fe89b934.js" as="script">
<link rel="preload" href="/Relay.swift/1.46ef3b44.js" as="script">
<link rel="preload" href="/Relay.swift/2.87a3c185.js" as="script">
<link rel="preload" href="/Relay.swift/121.1bf8ea46.js" as="script">
<link rel="preload" href="/Relay.swift/122.c9f6834b.js" as="script">
<link rel="preload" href="/Relay.swift/e15bcb33.7e8a1d66.js" as="script">
<link rel="preload" href="/Relay.swift/17896441.e4122df4.js" as="script">
<link rel="preload" href="/Relay.swift/255289db.9b7d6bfd.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/Relay.swift/"><strong class="navbar__title">Relay.swift</strong></a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/Relay.swift/docs/">1.1.0</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/Relay.swift/docs/next/getting-started/fragments">Next</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/Relay.swift/docs/getting-started/fragments">1.1.0</a></li><li><a class="dropdown__link" href="/Relay.swift/docs/1.0.0/getting-started/fragments">1.0.0</a></li></ul></div><a class="navbar__item navbar__link" href="/Relay.swift/docs/knowledge-base">Knowledge base</a><a class="navbar__item navbar__link" href="/Relay.swift/releases/">Releases</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/relay-tools/Relay.swift" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/Relay.swift/"><strong class="navbar__title">Relay.swift</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a role="button" class="menu__link menu__link--sublist">Versions</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/Relay.swift/docs/next/getting-started/fragments">Next</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/Relay.swift/docs/getting-started/fragments">1.1.0</a></li><li class="menu__list-item"><a class="menu__link" href="/Relay.swift/docs/1.0.0/getting-started/fragments">1.0.0</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/Relay.swift/docs/knowledge-base">Knowledge base</a></li><li class="menu__list-item"><a class="menu__link" href="/Relay.swift/releases/">Releases</a></li><li class="menu__list-item"><a href="https://github.com/relay-tools/Relay.swift" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/Relay.swift/docs/">Relay.swift</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Getting started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Relay.swift/docs/getting-started/installation">Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Relay.swift/docs/getting-started/relay-environment">The Relay environment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Relay.swift/docs/getting-started/fetching-data">Fetching data with queries</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/Relay.swift/docs/getting-started/fragments">Composing views with fragments</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Relay.swift/docs/getting-started/mutations">Making changes with mutations</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">API reference</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Relay.swift</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/api/intro-relay">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/api/graphql">GraphQL tagged strings</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/api/environment">Environment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/api/network">Network layer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/api/store">Store</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/api/record-source-selector-proxy">RecordSourceSelectorProxy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/api/record-proxy">RecordProxy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/api/connection-handler">ConnectionHandler</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/api/mock-environment">MockEnvironment</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Relay in SwiftUI</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/api/intro-relay-swift-ui">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/api/relay-environment-modifier">relayEnvironment()</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/api/relay-environment-wrapper">@RelayEnvironment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/api/query">@Query</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/api/fragment">@Fragment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/api/refetchable-fragment">@RefetchableFragment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/api/pagination-fragment">@PaginationFragment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/api/mutation">@Mutation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/api/preview-payload">previewPayload()</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Development</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/development/contributing">Contributing</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col"><div class="docItemContainer_a7m4"><article><div><span class="badge badge--secondary">Version: 1.1.0</span></div><header><h1 class="docTitle_Oumm">Composing views with fragments</h1></header><div class="markdown"><p>Let&#x27;s start building a real app. We&#x27;re going to show a to-do list using a table view, with each row being a single to-do item in the list.</p><p>SwiftUI lets you build small, focused views that you can compose together to create your UI, so let&#x27;s start really small and build the view for showing a single to-do item in the list.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-swift codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">import SwiftUI</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">struct ToDoItem: View {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    let text: String</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    let complete: Bool</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    var body: some View {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        HStack {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            Image(systemName: complete ? &quot;checkmark.square&quot; : &quot;square&quot;)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            Text(verbatim: text)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>This is a pretty simple view, but it&#x27;s already showing one of the challenges we face when building UIs with many small views. The <code>text</code> and <code>complete</code> data this view needs are available on the <code>Todo</code> type in our GraphQL schema, but how do we get them into this view? If we use a <a href="/Relay.swift/docs/api/query">@Query</a>, then every single to-do item in the list will make a separate network request to the server to load its data, so we probably don&#x27;t want to do that.</p><p>We could just make sure to include these fields in a <a href="/Relay.swift/docs/api/query">@Query</a> on a component higher-up in the tree and then pass that data down into the <code>ToDoItem</code> view. But this makes it harder to re-use the view elsewhere in the app, since those fields will need to be included in those queries as well. Even if this is the only screen where we use this view, this approach has problems. Other views that render a <code>ToDoItem</code> shouldn&#x27;t have to care exactly what data it needs, and if we combine fields from many views into a single query, it&#x27;s unclear which views are using a given piece of data.</p><p>Relay and Relay.swift are designed to help with this problem by making it easy to compose not just views but also the data they require. To do this, we use GraphQL fragments, which let us define a named selection of fields on a GraphQL type. Let&#x27;s define one for <code>ToDoItem</code>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-swift codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">import SwiftUI</span></div><div class="token-line" style="color:#393A34"><span class="token plain">import RelaySwiftUI</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">private let todoFragment = graphql(&quot;&quot;&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">fragment ToDoItem_todo on Todo {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    text</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    complete</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div><div class="token-line" style="color:#393A34"><span class="token plain">&quot;&quot;&quot;)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>This fragment expresses exactly the data we need to render this view. Run <code>npx relay-compiler</code> to generate a new file <code>__generated__/ToDoItem_todo.graphql.swift</code> that includes some additional types we can use to work with this fragment. Be sure to add the new file to the project.</p><p>Now we can update our view to take in data using the fragment instead of individual parameters:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-swift codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">import SwiftUI</span></div><div class="token-line" style="color:#393A34"><span class="token plain">import RelaySwiftUI</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">private let todoFragment = graphql(&quot;&quot;&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">fragment ToDoItem_todo on Todo {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    text</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    complete</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div><div class="token-line" style="color:#393A34"><span class="token plain">&quot;&quot;&quot;)</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">struct ToDoItem: View {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    @Fragment&lt;ToDoItem_todo&gt; var todo</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    var body: some View {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        if let todo = todo {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            HStack {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                Image(systemName: todo.complete ? &quot;checkmark.square&quot; : &quot;square&quot;)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                Text(verbatim: todo.text)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>We&#x27;re using the <a href="/Relay.swift/docs/api/fragment">@Fragment</a> property wrapper this time instead of <a href="/Relay.swift/docs/api/query">@Query</a>. <a href="/Relay.swift/docs/api/fragment">@Fragment</a> doesn&#x27;t load new data over the network; instead, it lets us read data that&#x27;s already been loaded by another fragment or query.</p><p>Now that we&#x27;ve wrapped up the data that <code>ToDoItem</code> needs in a fragment, we can&#x27;t pass in the values for <code>text</code> and <code>complete</code> directly anymore. So how do we create a <code>ToDoItem</code> and tell it which to-do item to render? Let&#x27;s see how to use this fragment view inside another view.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="composition-with-fragments"></a>Composition with fragments<a class="hash-link" href="#composition-with-fragments" title="Direct link to heading">#</a></h2><p>Fragments are composable just like SwiftUI views. Let&#x27;s create a new view for a showing the to-do list for a user. This view will also use a fragment to express the data it needs, and it will use the <code>ToDoItem</code> view we already defined to show each item.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-swift codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">import SwiftUI</span></div><div class="token-line" style="color:#393A34"><span class="token plain">import RelaySwiftUI</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">private let userFragment = graphql(&quot;&quot;&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">fragment ToDoList_user on User {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  todos(first: 100) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        edges {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            node {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                id</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                ...ToDoItem_todo</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div><div class="token-line" style="color:#393A34"><span class="token plain">&quot;&quot;&quot;)</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">struct ToDoList: View {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    @Fragment&lt;ToDoList_user&gt; var user</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    var body: some View {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        if let user = user {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            List(user.todos ?? []) { todo in</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                ToDoItem(todo: todo.asFragment())</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>This view asks for the first 100 todos for a user and shows them in a list. The only information it asks for from each item is the ID, which it needs to provide to the <code>List</code> view for diffing. Otherwise, it delegates displaying the to-do item to the <code>ToDoItem</code> view, and uses the <code>ToDoItem_todo</code> fragment to load that data. If we forgot to include the <code>...ToDoItem_todo</code> in our fragment, we may not have the necessary data to create the <code>ToDoItem</code> view, and thanks to the type system, we would catch that at build time.</p><p>You might be surprised to find that if you tried to access the <code>text</code> or <code>complete</code> fields on a to-do item from this view, you wouldn&#x27;t be able to. The <code>ToDoList</code> view only has access to the fields explicitly listed in the <code>ToDoList_user</code> fragment. This prevents <code>ToDoList</code> from accidentally depending on data it didn&#x27;t ask for. But if we can&#x27;t access those fields, how are we able to pass the to-do item on to the <code>ToDoItem</code> view?</p><p>Because we included the <code>...ToDoItem_todo</code> in our fragment, the generated <code>Todo_node</code> type has the <code>asFragment()</code> method, which converts it to a <code>@Fragment</code> value that can be passed directly to <code>ToDoItem</code>&#x27;s default initializer. The fragment it creates doesn&#x27;t actually include the data that <code>ToDoItem</code> needs: it just has a pointer to where in Relay&#x27;s store it can find that data. When the <code>todo</code> property is used in <code>ToDoItem</code>, it will look up that information itself.</p><p>By using <code>asFragment()</code>, we can easily pass data between components using <a href="/Relay.swift/docs/api/fragment">@Fragment</a>s while ensuring each individual component is explicitly asking for exactly the data it needs.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="fetching-fragment-data"></a>Fetching fragment data<a class="hash-link" href="#fetching-fragment-data" title="Direct link to heading">#</a></h2><p>Now we&#x27;ve seen how we can pass data from one fragment to another, but our <code>ToDoList</code> still takes in a fragment, which we can&#x27;t construct ourselves. How we do complete the chain of fragments and actually load all the data required for them?</p><p>We&#x27;ve already seen how to load data using a <a href="/Relay.swift/docs/api/query">@Query</a> property. That&#x27;s exactly what we&#x27;ll use to load our fragment data. We can include our fragments in queries just as well as other fragments. So to present a screen that shows the to-do list for the current user, we can create a view for that:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-swift codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">import SwiftUI</span></div><div class="token-line" style="color:#393A34"><span class="token plain">import RelaySwiftUI</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">private let query = graphql(&quot;&quot;&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">query CurrentUserToDoListQuery {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    user(&quot;me&quot;) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        id</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        ...ToDoList_user</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div><div class="token-line" style="color:#393A34"><span class="token plain">&quot;&quot;&quot;)</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">struct CurrentUserToDoList: View {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    @Query&lt;CurrentUserToDoListQuery&gt; var query</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    var body: some View {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        switch query.get() {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            case .loading:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                Text(&quot;Loading...&quot;)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            case .failure(let error):</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                Text(&quot;Error: \(error.localizedDescription)&quot;)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            case .success(let data):</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                if let user = data?.user {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    ToDoList(user: user.asFragment())</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                        .navigationBarTitle(&quot;To-do List for \(user.id)&quot;)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Here we spread (<code>...</code>) the <code>ToDoList_user</code> fragment on the <code>user</code> field, so we&#x27;re able to pass that user to the <code>ToDoList</code> view using <code>asFragment()</code>. The Relay compiler will ensure that the query fetches all of the fields that the <code>ToDoList</code> view and any of its children require, and the Swift compiler will ensure that we pass that data between each view correctly.</p><p>Stitching our views together using fragments gives us some really cool benefits. The entire to-do list screen loads with a single request to the server, but each individual view only knows:</p><ul><li>What data it requires to be able to render itself</li><li>Which child views it is responsible for rendering</li></ul><p>Views that are structured this way are much easier to both refactor and reuse. For instance, if the <code>ToDoItem</code> view suddenly needs to use another field from <code>Todo</code>, we only have to update <code>ToDoItem.swift</code> to include the new field in the fragment, run the Relay compiler, and then we can start using that field in the view. We don&#x27;t have to update any other views up the chain to ensure that the new field gets passed down, because those other views never knew what fields we needed to begin with!</p><img alt="To-do list app running in the iOS simulator" src="/Relay.swift/img/getting-started/todo-list-sim.png" style="float:right;width:300px"><p>Let&#x27;s update our app&#x27;s <code>ContentView</code> to use this new view so we can see how our app looks.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-swift codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">import SwiftUI</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">struct ContentView: View {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    var body: some View {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        NavigationView {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            CurrentUserToDoList()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>We should be able to run our app now and see it working in the iPhone Simulator.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/relay-tools/Relay.swift/edit/main/website/versioned_docs/version-1.1.0/getting-started/fragments.mdx" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/Relay.swift/docs/getting-started/fetching-data"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Fetching data with queries</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/Relay.swift/docs/getting-started/mutations"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Making changes with mutations Â»</div></a></div></nav></div></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Matt Moriarity.</div></div></div></footer></div>
<script src="/Relay.swift/styles.b64df67e.js"></script>
<script src="/Relay.swift/runtime~main.dd5e0709.js"></script>
<script src="/Relay.swift/main.fe89b934.js"></script>
<script src="/Relay.swift/1.46ef3b44.js"></script>
<script src="/Relay.swift/2.87a3c185.js"></script>
<script src="/Relay.swift/121.1bf8ea46.js"></script>
<script src="/Relay.swift/122.c9f6834b.js"></script>
<script src="/Relay.swift/e15bcb33.7e8a1d66.js"></script>
<script src="/Relay.swift/17896441.e4122df4.js"></script>
<script src="/Relay.swift/255289db.9b7d6bfd.js"></script>
</body>
</html>