<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/Relay.swift/releases/rss.xml" title="Relay.swift Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/Relay.swift/releases/atom.xml" title="Relay.swift Blog Atom Feed"><title data-react-helmet="true">Making changes with mutations | Relay.swift</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="1.0.0"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-1.0.0"><meta data-react-helmet="true" property="og:title" content="Making changes with mutations | Relay.swift"><meta data-react-helmet="true" name="description" content="So far, all our app has done is display existing data. Most interesting apps also let you change data. In GraphQL, this is supported by using mutations. Our to-do list app&#x27;s schema includes several mutations for working with to-do items, and we can use these to add some interactivity to our app."><meta data-react-helmet="true" property="og:description" content="So far, all our app has done is display existing data. Most interesting apps also let you change data. In GraphQL, this is supported by using mutations. Our to-do list app&#x27;s schema includes several mutations for working with to-do items, and we can use these to add some interactivity to our app."><meta data-react-helmet="true" property="og:url" content="https://relay-tools.github.io/Relay.swift/docs/1.0.0/getting-started/mutations"><link data-react-helmet="true" rel="shortcut icon" href="/Relay.swift/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://relay-tools.github.io/Relay.swift/docs/1.0.0/getting-started/mutations"><link rel="stylesheet" href="/Relay.swift/styles.62dfcd7f.css">
<link rel="preload" href="/Relay.swift/styles.b64df67e.js" as="script">
<link rel="preload" href="/Relay.swift/runtime~main.dd5e0709.js" as="script">
<link rel="preload" href="/Relay.swift/main.fe89b934.js" as="script">
<link rel="preload" href="/Relay.swift/1.46ef3b44.js" as="script">
<link rel="preload" href="/Relay.swift/2.87a3c185.js" as="script">
<link rel="preload" href="/Relay.swift/121.1bf8ea46.js" as="script">
<link rel="preload" href="/Relay.swift/122.c9f6834b.js" as="script">
<link rel="preload" href="/Relay.swift/62e81aa6.86a600c2.js" as="script">
<link rel="preload" href="/Relay.swift/17896441.e4122df4.js" as="script">
<link rel="preload" href="/Relay.swift/3e9fd978.86f4e88a.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/Relay.swift/"><strong class="navbar__title">Relay.swift</strong></a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/Relay.swift/docs/1.0.0/">1.0.0</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/Relay.swift/docs/next/getting-started/mutations">Next</a></li><li><a class="dropdown__link" href="/Relay.swift/docs/getting-started/mutations">1.1.0</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/Relay.swift/docs/1.0.0/getting-started/mutations">1.0.0</a></li></ul></div><a class="navbar__item navbar__link" href="/Relay.swift/docs/knowledge-base">Knowledge base</a><a class="navbar__item navbar__link" href="/Relay.swift/releases/">Releases</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/relay-tools/Relay.swift" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/Relay.swift/"><strong class="navbar__title">Relay.swift</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a role="button" class="menu__link menu__link--sublist">Versions</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/Relay.swift/docs/next/getting-started/mutations">Next</a></li><li class="menu__list-item"><a class="menu__link" href="/Relay.swift/docs/getting-started/mutations">1.1.0</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/Relay.swift/docs/1.0.0/getting-started/mutations">1.0.0</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/Relay.swift/docs/knowledge-base">Knowledge base</a></li><li class="menu__list-item"><a class="menu__link" href="/Relay.swift/releases/">Releases</a></li><li class="menu__list-item"><a href="https://github.com/relay-tools/Relay.swift" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/Relay.swift/docs/1.0.0/">Relay.swift</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Getting started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Relay.swift/docs/1.0.0/getting-started/installation">Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Relay.swift/docs/1.0.0/getting-started/relay-environment">The Relay environment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Relay.swift/docs/1.0.0/getting-started/fetching-data">Fetching data with queries</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Relay.swift/docs/1.0.0/getting-started/fragments">Composing views with fragments</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/Relay.swift/docs/1.0.0/getting-started/mutations">Making changes with mutations</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">API reference</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Relay.swift</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/1.0.0/api/intro-relay">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/1.0.0/api/graphql">GraphQL tagged strings</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/1.0.0/api/environment">Environment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/1.0.0/api/network">Network layer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/1.0.0/api/store">Store</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/1.0.0/api/record-source-selector-proxy">RecordSourceSelectorProxy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/1.0.0/api/record-proxy">RecordProxy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/1.0.0/api/connection-handler">ConnectionHandler</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/1.0.0/api/mock-environment">MockEnvironment</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Relay in SwiftUI</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/1.0.0/api/intro-relay-swift-ui">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/1.0.0/api/relay-environment-modifier">relayEnvironment()</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/1.0.0/api/relay-environment-wrapper">@RelayEnvironment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/1.0.0/api/query">@Query</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/1.0.0/api/fragment">@Fragment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/1.0.0/api/refetchable-fragment">@RefetchableFragment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/1.0.0/api/pagination-fragment">@PaginationFragment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/1.0.0/api/mutation">@Mutation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/1.0.0/api/preview-payload">previewPayload()</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Development</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/1.0.0/development/contributing">Contributing</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col"><div class="alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for Relay.swift <strong>1.0.0</strong>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <strong><a href="/Relay.swift/docs/getting-started/mutations">latest version</a></strong> (1.1.0).</div></div><div class="docItemContainer_a7m4"><article><div><span class="badge badge--secondary">Version: 1.0.0</span></div><header><h1 class="docTitle_Oumm">Making changes with mutations</h1></header><div class="markdown"><p>So far, all our app has done is display existing data. Most interesting apps also let you change data. In GraphQL, this is supported by using mutations. Our to-do list app&#x27;s schema includes several mutations for working with to-do items, and we can use these to add some interactivity to our app.</p><p>Our to-do items have checkboxes but right now, tapping them doesn&#x27;t do anything. Let&#x27;s fix that using the <code>changeTodoStatus</code> mutation. Mutations don&#x27;t belong to a single view, let&#x27;s create a new file just for this mutation called <code>ChangeTodoStatus.swift</code>.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-swift codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">import Relay</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">private let mutation = graphql(&quot;&quot;&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">mutation ChangeTodoStatusMutation($input: ChangeTodoStatusInput!) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    changeTodoStatus(input: $input) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        todo {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            id</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            complete</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div><div class="token-line" style="color:#393A34"><span class="token plain">&quot;&quot;&quot;)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>In GraphQL, mutations can return data just like queries can. Relay.swift will use this data to update the data in its local store. Knowing this, we make our mutation return the <code>complete</code> field on the to-do item we&#x27;re changing, since we expect this mutation to change its value and we want our UI to update accordingly.</p><p>When we run <code>npx relay-compiler</code>, a <code>__generated__/ChangeTodoStatusMutation.graphql.swift</code> file is generate. We can add that file to our project and then start using this mutation in one of our views.</p><p>Let&#x27;s go back to our <code>ToDoItem</code> view and turn our checkbox into a button that uses the mutation.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-swift codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">import SwiftUI</span></div><div class="token-line" style="color:#393A34"><span class="token plain">import RelaySwiftUI</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">private let todoFragment = graphql(&quot;&quot;&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">fragment ToDoItem_todo on Todo {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    id</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    text</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    complete</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div><div class="token-line" style="color:#393A34"><span class="token plain">&quot;&quot;&quot;)</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">struct ToDoItem: View {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    @Fragment&lt;ToDoItem_todo&gt; var todo</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    @Mutation&lt;ChangeTodoStatusMutation&gt; var changeStatus</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    var body: some View {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        if let todo = todo {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            HStack {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                Button {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    changeStatus.commit(variables: .init(input: .init(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                        complete: !todo.complete,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                        id: id,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                        userId: &quot;me&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    )))</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                } label: {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    Image(systemName: todo.complete ? &quot;checkmark.square&quot; : &quot;square&quot;)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                .buttonStyle(BorderlessButtonStyle())</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                .disabled(changeStatus.isInFlight)</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                Text(verbatim: todo.text)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>To use our new mutation in a SwiftUI view, we add a <a href="/Relay.swift/docs/1.0.0/api/mutation">@Mutation</a> property for it. This property has a <code>commit</code> function and an <code>isInFlight</code> property. We use the <code>commit</code> function in the action of our new Button to perform the mutation. Until the server responds to us, the <code>isInFlight</code> property will be <code>true</code>. We use that to disable the button, both to indicate to the user that something is happening and to prevent redundant requests to the server.</p><p>Once the server performs our mutation and responds to our request, Relay.swift will use the <code>id</code> and <code>complete</code> fields in the response to update the data in its local store. When this happens, we&#x27;ll see the checkbox for our to-do item toggle automatically without us having to trigger an update. This works because <a href="/Relay.swift/docs/1.0.0/api/query">@Query</a> and <a href="/Relay.swift/docs/1.0.0/api/fragment">@Fragment</a> properties automatically subscribe to changes to their data, so whenever some data they&#x27;re responsible for displaying changes in the store, they will re-render their view.</p><p>Because of how our input types are structured, our button&#x27;s action callback is a little noisy. We can hide some of this complexity outside our view code behind a cleaner API. Let&#x27;s add an extension to <code>ChangeTodoStatus.swift</code> to provide a cleaner commit function for this mutation:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-swift codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">import Relay</span></div><div class="token-line" style="color:#393A34"><span class="token plain">import RelaySwiftUI</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">private let mutation = graphql(&quot;&quot;&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">mutation ChangeTodoStatusMutation($input: ChangeTodoStatusInput!) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    changeTodoStatus(input: $input) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        todo {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            id</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            complete</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div><div class="token-line" style="color:#393A34"><span class="token plain">&quot;&quot;&quot;)</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">extension Mutation.Mutator where Operation == ChangeTodoStatusMutation {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    func commit(id: String, complete: Bool) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        commit(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            variables: .init(input: .init(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                complete: complete,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                id: id,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                userId: &quot;me&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            ))</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><code>Mutation.Mutator</code> is the type returned by a <a href="/Relay.swift/docs/1.0.0/api/mutation">@Mutation</a> property. We&#x27;re adding a special <code>commit</code> function to this type specifically when the operation is a <code>ChangeTodoStatusMutation</code>. Now we can make our button action easier to read.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-swift codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Button {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    changeStatus.commit(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        id: todo.id,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        complete: !todo.complete</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">} label: {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    Image(systemName: todo.complete ? &quot;checkmark.square&quot; : &quot;square&quot;)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div><div class="token-line" style="color:#393A34"><span class="token plain">.buttonStyle(BorderlessButtonStyle())</span></div><div class="token-line" style="color:#393A34"><span class="token plain">.disabled(changeStatus.isInFlight)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Now it&#x27;s much clearer what&#x27;s happening.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="optimistic-updates-for-immediate-feedback"></a>Optimistic updates for immediate feedback<a class="hash-link" href="#optimistic-updates-for-immediate-feedback" title="Direct link to heading">#</a></h2><p>Right now, the checkbox is only updating once the server responds. On a slow connection, this could take several seconds, during which our user might feel confused about why the state hasn&#x27;t changed.</p><p>We can&#x27;t fix their connection speed, but we can make our app feel more responsive by assuming the mutation will succeed and updating the app state accordingly. This is called an optimistic update, and it&#x27;s a great way to improve the experience of using your app.</p><p>In Relay, an optimistic update works by taking a snapshot of the local store and then applying the change. This causes the app UI to immediately update. When the real response comes in, the optimistic update is rolled back, and the real response is handled instead. Ideally, the outcome is the same, but if the real response is an error, the rollback ensures you don&#x27;t keep showing incorrect data.</p><p>Let&#x27;s update our mutation to use an optimistic response:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-swift codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">import Relay</span></div><div class="token-line" style="color:#393A34"><span class="token plain">import RelaySwiftUI</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">private let mutation = graphql(&quot;&quot;&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">mutation ChangeTodoStatusMutation($input: ChangeTodoStatusInput!) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    changeTodoStatus(input: $input) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        todo {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            id</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            complete</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div><div class="token-line" style="color:#393A34"><span class="token plain">&quot;&quot;&quot;)</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">extension Mutation.Mutator where Operation == ChangeTodoStatusMutation {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    func commit(id: String, complete: Bool) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        commit(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            variables: .init(input: .init(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                complete: complete,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                id: id,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                userId: &quot;me&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            )),</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            optimisticResponse: [</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                &quot;changeTodoStatus&quot;: [</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    &quot;todo&quot;: [</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                        &quot;id&quot;: id,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                        &quot;complete&quot;: complete,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    ]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                ]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            ]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Our special commit function is coming in handy again. We&#x27;ve added an <code>optimisticResponse</code> parameter to our commit call. This value is a dictionary that should match what the <code>data</code> property in the actual GraphQL response is expected to contain. It should match the structure of the mutation itself, as this one does.</p><p>Now when we tap our checkbox button, our UI will update immediately, and as long as our request succeeds, we&#x27;ll never notice that it wasn&#x27;t already done.</p><hr><p>That&#x27;s all for this guide. We&#x27;ve covered the basics of using Relay.swift to build SwiftUI apps, which will get you pretty far. You can find more detailed information in our API docs:</p><ul><li><a href="/Relay.swift/docs/1.0.0/api/intro-relay">API Reference: Relay.swift</a></li><li><a href="/Relay.swift/docs/1.0.0/api/intro-relay-swift-ui">API Reference: Relay in SwiftUI</a></li></ul></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/relay-tools/Relay.swift/edit/main/website/versioned_docs/version-1.0.0/getting-started/mutations.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/Relay.swift/docs/1.0.0/getting-started/fragments"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Composing views with fragments</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/Relay.swift/docs/1.0.0/api/intro-relay"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Introduction Â»</div></a></div></nav></div></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Matt Moriarity.</div></div></div></footer></div>
<script src="/Relay.swift/styles.b64df67e.js"></script>
<script src="/Relay.swift/runtime~main.dd5e0709.js"></script>
<script src="/Relay.swift/main.fe89b934.js"></script>
<script src="/Relay.swift/1.46ef3b44.js"></script>
<script src="/Relay.swift/2.87a3c185.js"></script>
<script src="/Relay.swift/121.1bf8ea46.js"></script>
<script src="/Relay.swift/122.c9f6834b.js"></script>
<script src="/Relay.swift/62e81aa6.86a600c2.js"></script>
<script src="/Relay.swift/17896441.e4122df4.js"></script>
<script src="/Relay.swift/3e9fd978.86f4e88a.js"></script>
</body>
</html>