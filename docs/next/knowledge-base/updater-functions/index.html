<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/Relay.swift/releases/rss.xml" title="Relay.swift Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/Relay.swift/releases/atom.xml" title="Relay.swift Blog Atom Feed"><title data-react-helmet="true">Updater functions | Relay.swift</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Updater functions | Relay.swift"><meta data-react-helmet="true" name="description" content="`swift"><meta data-react-helmet="true" property="og:description" content="`swift"><meta data-react-helmet="true" property="og:url" content="https://relay-tools.github.io/Relay.swift/docs/next/knowledge-base/updater-functions"><link data-react-helmet="true" rel="shortcut icon" href="/Relay.swift/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://relay-tools.github.io/Relay.swift/docs/next/knowledge-base/updater-functions"><link rel="stylesheet" href="/Relay.swift/styles.62dfcd7f.css">
<link rel="preload" href="/Relay.swift/styles.144f0b80.js" as="script">
<link rel="preload" href="/Relay.swift/runtime~main.f2ac6820.js" as="script">
<link rel="preload" href="/Relay.swift/main.d2f021be.js" as="script">
<link rel="preload" href="/Relay.swift/1.c8555c82.js" as="script">
<link rel="preload" href="/Relay.swift/2.97c26455.js" as="script">
<link rel="preload" href="/Relay.swift/87.b920650e.js" as="script">
<link rel="preload" href="/Relay.swift/88.a1cb33e6.js" as="script">
<link rel="preload" href="/Relay.swift/935f2afb.aefec6fc.js" as="script">
<link rel="preload" href="/Relay.swift/17896441.dd035e36.js" as="script">
<link rel="preload" href="/Relay.swift/3a75bd0f.68e25693.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/Relay.swift/"><strong class="navbar__title">Relay.swift</strong></a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/Relay.swift/docs/next/">Next</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/Relay.swift/docs/next/knowledge-base/updater-functions">Next</a></li><li><a class="dropdown__link" href="/Relay.swift/docs/knowledge-base/updater-functions">1.0.0</a></li></ul></div><a class="navbar__item navbar__link" href="/Relay.swift/docs/knowledge-base">Knowledge base</a><a class="navbar__item navbar__link" href="/Relay.swift/releases/">Releases</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/relay-tools/Relay.swift" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/Relay.swift/"><strong class="navbar__title">Relay.swift</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a role="button" class="menu__link menu__link--sublist">Versions</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/Relay.swift/docs/next/knowledge-base/updater-functions">Next</a></li><li class="menu__list-item"><a class="menu__link" href="/Relay.swift/docs/knowledge-base/updater-functions">1.0.0</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/Relay.swift/docs/knowledge-base">Knowledge base</a></li><li class="menu__list-item"><a class="menu__link" href="/Relay.swift/releases/">Releases</a></li><li class="menu__list-item"><a href="https://github.com/relay-tools/Relay.swift" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for Relay.swift <strong>Next</strong> version.</div><div class="margin-top--md">For up-to-date documentation, see the <strong><a href="/Relay.swift/docs/knowledge-base/updater-functions">latest version</a></strong> (1.0.0).</div></div><div class="docItemContainer_a7m4"><article><div><span class="badge badge--secondary">Version: Next</span></div><header><h1 class="docTitle_Oumm">Updater functions</h1></header><div class="markdown"><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-swift codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">typealias SelectorStoreUpdater = (</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    inout RecordSourceSelectorProxy,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    SelectorData?</span></div><div class="token-line" style="color:#393A34"><span class="token plain">) -&gt; Void</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Updater functions provide a hook for you to update Relay&#x27;s local <a href="/Relay.swift/docs/next/api/store">Store</a> when a mutation completes. You can use this to make arbitrary complex changes to the store without refetching data from the server. This can make your app feel more responsive, especially when paired with optimistic updates.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="do-you-need-an-updater-function"></a>Do you need an updater function?<a class="hash-link" href="#do-you-need-an-updater-function" title="Direct link to heading">#</a></h2><p>If your mutation only changes some properties of an existing record, you probably don&#x27;t need an updater. Relay will match records in the mutation&#x27;s response to the records that already exist in the store and update their fields. If your mutation response includes the fields you expect to change on the record, they&#x27;ll update in the store and your UI automatically.</p><p>For more complex changes that Relay can&#x27;t infer automatically, you can use an updater function. Some situations where you would want to use an updater function:</p><ul><li>Adding a record to a list</li><li>Deleting a record from a list</li><li>Reordering records in a list</li><li>Any combination of the above</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="how-do-updater-functions-work"></a>How do updater functions work?<a class="hash-link" href="#how-do-updater-functions-work" title="Direct link to heading">#</a></h2><p>You provide an updater function with the <code>updater</code> or <code>optimisticUpdater</code> parameter when committing a mutation. Most of the time, can use the same updater function for both the optimistic and non-optimistic updaters. Updater functions are only run on a successful response; error responses will not run the updater.</p><p>When you commit a mutation, a few different actions will happen in order. The exact actions depend on which parameters you provide:</p><ol><li>If you provide an <code>optimisticResponse</code>, then the store will be updated as though it was the real response.</li><li>If you provide an <code>optimisticUpdater</code>, then that function will be called with a proxy to the Relay store.</li><li>Relay will wait for the response to the mutation from the server.</li><li>Any changes applied optimistically will be rolled back, so you&#x27;re starting from a clean slate.</li><li>If the response is successful:<ol><li>The store will be updated with the record data from the response.</li><li>If you provide an <code>updater</code>, then that function will be called with a proxy to the Relay store.</li></ol></li></ol><p>An updater function takes two parameters:</p><ul><li><code>store</code>: a <a href="/Relay.swift/docs/next/api/record-source-selector-proxy">RecordSourceSelectorProxy</a> that you can use to read and change records in the Relay store.</li><li><code>data</code>: a <code>SelectorData</code> instance with the response from the mutation. This may be <code>nil</code> if the response is missing non-optional data or if you&#x27;re running an optimistic updater without an optimistic response.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="example-adding-a-new-edge-to-a-connection"></a>Example: adding a new edge to a connection<a class="hash-link" href="#example-adding-a-new-edge-to-a-connection" title="Direct link to heading">#</a></h2><p>One of the most common reasons to use an updater is to change the contents of a list, often a list of edges in a paging connection. Let&#x27;s see how we can use an updater to keep a list up-to-date when we add a new item. We&#x27;ll use the following mutation to create a new to-do item:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-graphql codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">mutation</span><span class="token plain"> AddToDoItemMutation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token variable" style="color:#36acaa">$input</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> AddTodoInput</span><span class="token operator" style="color:#393A34">!</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    addTodo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">input</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$input</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        todoEdge </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            node </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token operator" style="color:#393A34">...</span><span class="token fragment function" style="color:#d73a49">ToDoItem_todo</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            cursor</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The result of the <code>addTodo</code> mutation in our schema includes a <code>todoEdge</code> field to return the entire edge for our new to-do item, which will be really convenient for adding it to our list. We use the <code>ToDoItem_todo</code> fragment from our view to make sure that we get all the data for the new to-do item that our UI needs to be able to display it.</p><p>Because this to-do item will be a new record, the response alone is not enough for Relay to do anything useful. We need to update the list of edges in our connection to include it using an updater. Let&#x27;s see what that updater would look like:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-swift codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">private let updater: SelectorStoreUpdater = { store, data in</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    let handler = ConnectionHandler.default</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    guard</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        let user = store.root.getLinkedRecord(&quot;user&quot;, args: [&quot;id&quot;: &quot;me&quot;]),</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        var todos = handler.getConnection(user, key: &quot;ToDoList_todos&quot;),</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        let edge = store.getRootField(&quot;addTodo&quot;)?.getLinkedRecord(&quot;todoEdge&quot;)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    else {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        return</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    handler.insert(connection: &amp;todos, edge: edge, before: nil)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>In this updater, we use the <a href="/Relay.swift/docs/next/api/connection-handler">ConnectionHandler</a> methods provided by Relay to help us get the right record for our pagination connection and add an edge to it. We use the <code>getRootField</code> method on the <a href="/Relay.swift/docs/next/api/record-source-selector-proxy">RecordSourceSelectorProxy</a> to traverse to the record in our mutation&#x27;s response that has the new edge. Once we have the connection record and the new edge, we insert it at the beginning of the list.</p><p>Using this updater, when we add a new to-do item, it&#x27;ll be prepended to the list of to-do items in our app. Our app&#x27;s user interface will update to reflect this without needing to refetch the list of to-do items from the server. Updaters let us keep our app&#x27;s local state consistent with the server&#x27;s state as the user makes changes without unnecessary refetches.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/relay-tools/Relay.swift/edit/main/website/docs/knowledge-base/updater-functions.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#do-you-need-an-updater-function" class="table-of-contents__link">Do you need an updater function?</a></li><li><a href="#how-do-updater-functions-work" class="table-of-contents__link">How do updater functions work?</a></li><li><a href="#example-adding-a-new-edge-to-a-connection" class="table-of-contents__link">Example: adding a new edge to a connection</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Matt Moriarity.</div></div></div></footer></div>
<script src="/Relay.swift/styles.144f0b80.js"></script>
<script src="/Relay.swift/runtime~main.f2ac6820.js"></script>
<script src="/Relay.swift/main.d2f021be.js"></script>
<script src="/Relay.swift/1.c8555c82.js"></script>
<script src="/Relay.swift/2.97c26455.js"></script>
<script src="/Relay.swift/87.b920650e.js"></script>
<script src="/Relay.swift/88.a1cb33e6.js"></script>
<script src="/Relay.swift/935f2afb.aefec6fc.js"></script>
<script src="/Relay.swift/17896441.dd035e36.js"></script>
<script src="/Relay.swift/3a75bd0f.68e25693.js"></script>
</body>
</html>