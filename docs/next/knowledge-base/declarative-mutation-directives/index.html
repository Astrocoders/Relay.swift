<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/Relay.swift/releases/rss.xml" title="Relay.swift Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/Relay.swift/releases/atom.xml" title="Relay.swift Blog Atom Feed"><title data-react-helmet="true">Declarative mutation directives | Relay.swift</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Declarative mutation directives | Relay.swift"><meta data-react-helmet="true" name="description" content="In version 10.1.0, Relay added support for declarative mutation directives in both the compiler and the JavaScript library. Relay.swift also supports these directives, which can remove the need to write updater functions for your mutations for some common cases of adding and removing records."><meta data-react-helmet="true" property="og:description" content="In version 10.1.0, Relay added support for declarative mutation directives in both the compiler and the JavaScript library. Relay.swift also supports these directives, which can remove the need to write updater functions for your mutations for some common cases of adding and removing records."><meta data-react-helmet="true" property="og:url" content="https://relay-tools.github.io/Relay.swift/docs/next/knowledge-base/declarative-mutation-directives"><link data-react-helmet="true" rel="shortcut icon" href="/Relay.swift/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://relay-tools.github.io/Relay.swift/docs/next/knowledge-base/declarative-mutation-directives"><link rel="stylesheet" href="/Relay.swift/styles.62dfcd7f.css">
<link rel="preload" href="/Relay.swift/styles.144f0b80.js" as="script">
<link rel="preload" href="/Relay.swift/runtime~main.03cde870.js" as="script">
<link rel="preload" href="/Relay.swift/main.3a4ffd1c.js" as="script">
<link rel="preload" href="/Relay.swift/1.c8555c82.js" as="script">
<link rel="preload" href="/Relay.swift/2.97c26455.js" as="script">
<link rel="preload" href="/Relay.swift/87.b920650e.js" as="script">
<link rel="preload" href="/Relay.swift/88.a1cb33e6.js" as="script">
<link rel="preload" href="/Relay.swift/935f2afb.aefec6fc.js" as="script">
<link rel="preload" href="/Relay.swift/17896441.dd035e36.js" as="script">
<link rel="preload" href="/Relay.swift/8670f60a.3ae2b88d.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/Relay.swift/"><strong class="navbar__title">Relay.swift</strong></a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/Relay.swift/docs/next/">Next</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/Relay.swift/docs/next/knowledge-base/declarative-mutation-directives">Next</a></li><li><a class="dropdown__link" href="/Relay.swift/docs/">1.0.0</a></li></ul></div><a class="navbar__item navbar__link" href="/Relay.swift/docs/knowledge-base">Knowledge base</a><a class="navbar__item navbar__link" href="/Relay.swift/releases/">Releases</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/relay-tools/Relay.swift" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/Relay.swift/"><strong class="navbar__title">Relay.swift</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a role="button" class="menu__link menu__link--sublist">Versions</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/Relay.swift/docs/next/knowledge-base/declarative-mutation-directives">Next</a></li><li class="menu__list-item"><a class="menu__link" href="/Relay.swift/docs/">1.0.0</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/Relay.swift/docs/knowledge-base">Knowledge base</a></li><li class="menu__list-item"><a class="menu__link" href="/Relay.swift/releases/">Releases</a></li><li class="menu__list-item"><a href="https://github.com/relay-tools/Relay.swift" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for Relay.swift <strong>Next</strong> version.</div><div class="margin-top--md">For up-to-date documentation, see the <strong><a href="/Relay.swift/docs/">latest version</a></strong> (1.0.0).</div></div><div class="docItemContainer_a7m4"><article><div><span class="badge badge--secondary">Version: Next</span></div><header><h1 class="docTitle_Oumm">Declarative mutation directives</h1></header><div class="markdown"><p>In version <a href="https://github.com/facebook/relay/releases/tag/v10.1.0" target="_blank" rel="noopener noreferrer">10.1.0</a>, Relay added support for declarative mutation directives in both the compiler and the JavaScript library. Relay.swift also supports these directives, which can remove the need to write <a href="/Relay.swift/docs/next/knowledge-base/updater-functions">updater functions</a> for your mutations for some common cases of adding and removing records.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="adding-nodes-to-a-connection"></a>Adding nodes to a connection<a class="hash-link" href="#adding-nodes-to-a-connection" title="Direct link to heading">#</a></h2><p>Relay supports four directives for adding to the list of records managed by a <code>@connection</code>:</p><ul><li><code>@prependNode</code></li><li><code>@appendNode</code></li><li><code>@prependEdge</code></li><li><code>@appendEdge</code></li></ul><p>Let&#x27;s look at an example of how to use <code>@prependNode</code>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-graphql codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">mutation</span><span class="token plain"> AddTodoMutation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token variable" style="color:#36acaa">$input</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> AddTodoInput</span><span class="token operator" style="color:#393A34">!</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$connections</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">ID</span><span class="token operator" style="color:#393A34">!</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">!</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    addTodo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">input</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$input</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        todo </span><span class="token directive function" style="color:#d73a49">@prependNode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">connections</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$connections</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">edgeTypeName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;TodoEdge&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            id</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            text</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            complete</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>When we execute this mutation, we want the new <code>Todo</code> item to be inserted at the top of our list of todos. Normally, we would need to write an updater function to do this using <a href="/Relay.swift/docs/next/api/connection-handler">ConnectionHandler</a> methods and pass that function when we commit the mutation, but by marking the node in our mutation result with <code>@prependNode</code>, Relay do this automatically. Relay will automatically create a new edge record using the <code>edgeTypeName</code> we passed to the directive, and will set the <code>node</code> field of that record to the <code>todo</code> returned in the mutation&#x27;s response. Then it will add that edge to the beginning of the list of edges for the connection. Any views that are showing that connection will update to show the new item.</p><p><code>@appendNode</code> works just like <code>@prependNode</code>, but it adds the new item to the end of this list rather than the beginning.</p><p>Relay still needs to know which connection(s) to add the node to, so we pass those in to the directive with the <code>$connections</code> variable that we added to the mutation. The strings we pass in need to be the record IDs for each connection, not the <code>key</code> passed to the <code>@connection</code> directive. This is because a connection may support filter arguments, which cause one key to be used to store multiple records with different filtered versions of the same connection. Relay needs to know exactly which one(s) you want to update. See <a href="#getting-the-record-id-for-a-connection">further below</a> for how you can determine the record ID for your connections.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="returning-edges-instead-of-nodes"></a>Returning edges instead of nodes<a class="hash-link" href="#returning-edges-instead-of-nodes" title="Direct link to heading">#</a></h3><p>If the mutation&#x27;s response payload includes an edge record instead of just a node, we can use <code>@prependEdge</code> or <code>@appendEdge</code> instead:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-graphql codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">mutation</span><span class="token plain"> AddTodoMutation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token variable" style="color:#36acaa">$input</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> AddTodoInput</span><span class="token operator" style="color:#393A34">!</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$connections</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">ID</span><span class="token operator" style="color:#393A34">!</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">!</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    addTodo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">input</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$input</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        todoEdge </span><span class="token directive function" style="color:#d73a49">@prependEdge</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">connections</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$connections</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            cursor</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            node </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                id</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                text</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                complete</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>When using the edge variants of these directives, we don&#x27;t have to pass an <code>edgeTypeName</code>, since Relay doesn&#x27;t have to build the edge itself: the record already exists in the mutation&#x27;s response.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="deleting-nodes-from-a-connection"></a>Deleting nodes from a connection<a class="hash-link" href="#deleting-nodes-from-a-connection" title="Direct link to heading">#</a></h2><p>The <code>@deleteEdge</code> directive will remove the edge(s) corresponding to a particular node from one or more connections.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-graphql codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">mutation</span><span class="token plain"> RemoveTodoMutation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token variable" style="color:#36acaa">$input</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> RemoveTodoInput</span><span class="token operator" style="color:#393A34">!</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$connections</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">ID</span><span class="token operator" style="color:#393A34">!</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">!</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    removeTodo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">input</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$input</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        deletedTodoID </span><span class="token directive function" style="color:#d73a49">@deleteEdge</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">connections</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$connections</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>To use this directive, your mutation response must have a field corresponding to the ID of the node whose edge(s) you want to remove. If there are multiple edges in the connection for that node, all of them will be removed. The record itself remains in the store, so if it is referenced from other places, those references will continue to be valid.</p><p>As with the append and prepend directives, this directive needs the record IDs of the connections it should update. <a href="#getting-the-record-id-for-a-connection">See further below</a> for how you can determine the record ID for your connections.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="deleting-records-from-the-store"></a>Deleting records from the store<a class="hash-link" href="#deleting-records-from-the-store" title="Direct link to heading">#</a></h2><p>The <code>@deleteRecord</code> will remove a record entirely from Relay&#x27;s store.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-graphql codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">mutation</span><span class="token plain"> RemoveTodoMutation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token variable" style="color:#36acaa">$input</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> RemoveTodoInput</span><span class="token operator" style="color:#393A34">!</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    removeTodo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">input</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$input</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        deletedTodoID </span><span class="token directive function" style="color:#d73a49">@deleteRecord</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Similar to <code>@deleteEdge</code>, this directive is used on a field in your mutation response with the ID of the record to delete. Unlike <code>@deleteEdge</code>, <code>@deleteRecord</code> doesn&#x27;t remove any references to the record: it just deletes it. This can cause fragments to be missing data that they previously weren&#x27;t, so use this with care.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="getting-the-record-id-for-a-connection"></a>Getting the record ID for a connection<a class="hash-link" href="#getting-the-record-id-for-a-connection" title="Direct link to heading">#</a></h2><p>There are two ways to get a record ID that we can pass in to the <code>$connections</code> argument of our mutation. The preferred way is to ask for it in your query or fragment, and then pass it on to the mutation when you commit. The record ID for any record is available with the <code>__id</code> field.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-graphql codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">fragment</span><span class="token plain"> </span><span class="token fragment function" style="color:#d73a49">ToDoList_user</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">on</span><span class="token plain"> </span><span class="token class-name">User</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token directive function" style="color:#d73a49">@refetchable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">queryName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ToDoListPaginationQuery&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token directive function" style="color:#d73a49">@argumentDefinitions</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token attr-name" style="color:#00a4db">count</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Int&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">defaultValue</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token attr-name" style="color:#00a4db">cursor</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;String&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  todos</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">first</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$count</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">after</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$cursor</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token directive function" style="color:#d73a49">@connection</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ToDoList_todos&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      __id</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    edges </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      node </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        id</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">...</span><span class="token fragment function" style="color:#d73a49">ToDoItem_todo</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The <code>__id</code> field is similar to <code>__typename</code> in that it doesn&#x27;t need to be declared in your schema and is available as a selection anywhere in the graph. It will always return the ID Relay is using for the corresponding record in its store. You can then pass that ID as the connections when committing the mutation to add the item:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-swift codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">addTodo.commit(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    variables: .init(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        input: AddTodoInput(/* ... */),</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        connections: [user.todos.__id]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>This works well when you need to perform the mutation from the same view or a subview of the one that is using the connection, as there&#x27;s a direct way to pass the ID of the connection to the code that commits the mutation. In some cases, you may need to perform the mutation from a completely different part of your app from where you are viewing the data in the connection. For these situations, you can use the <code>getConnectionID(parentID:key:filters:)</code> method on <a href="/Relay.swift/docs/next/api/connection-handler">ConnectionHandler</a> to ask Relay directly for the ID of a particular connection record.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-swift codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">addTodo.commit(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    variables: .init(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        input: AddTodoInput(/* ... */),</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        connections: [</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            ConnectionHandler.default.getConnectionID(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                parentID: DataID(user.id),</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                key: &quot;ToDoList_todos&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        ]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>To use <code>getConnectionID</code>, you need to know the record ID for the parent record of the connection, as well as the key of the connection and any filter arguments if necessary. In this example, the connection is on a field of the <code>User</code> type, which implements <code>Node</code> so its record ID matches its <code>id</code> field. Some other common parent IDs for connections are:</p><ul><li><code>DataID.rootID</code>: for connections on fields on the root <code>Query</code> type of the schema</li><li><code>DataID.viewerID</code>: for connections on fields on the <code>Viewer</code> type</li></ul><p>If your connection is not on the <code>Query</code>, <code>Viewer</code>, or a <code>Node</code>, it won&#x27;t have a stable ID and you&#x27;ll need to fetch it from a query or fragment using the <code>__id</code> field. But you would be better off changing your schema instead, since in this case it also won&#x27;t be usable with <a href="/Relay.swift/docs/next/api/pagination-fragment">@PaginationFragment</a>, which has similar constraints.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/relay-tools/Relay.swift/edit/main/website/docs/knowledge-base/declarative-mutation-directives.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#adding-nodes-to-a-connection" class="table-of-contents__link">Adding nodes to a connection</a><ul><li><a href="#returning-edges-instead-of-nodes" class="table-of-contents__link">Returning edges instead of nodes</a></li></ul></li><li><a href="#deleting-nodes-from-a-connection" class="table-of-contents__link">Deleting nodes from a connection</a></li><li><a href="#deleting-records-from-the-store" class="table-of-contents__link">Deleting records from the store</a></li><li><a href="#getting-the-record-id-for-a-connection" class="table-of-contents__link">Getting the record ID for a connection</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Matt Moriarity.</div></div></div></footer></div>
<script src="/Relay.swift/styles.144f0b80.js"></script>
<script src="/Relay.swift/runtime~main.03cde870.js"></script>
<script src="/Relay.swift/main.3a4ffd1c.js"></script>
<script src="/Relay.swift/1.c8555c82.js"></script>
<script src="/Relay.swift/2.97c26455.js"></script>
<script src="/Relay.swift/87.b920650e.js"></script>
<script src="/Relay.swift/88.a1cb33e6.js"></script>
<script src="/Relay.swift/935f2afb.aefec6fc.js"></script>
<script src="/Relay.swift/17896441.dd035e36.js"></script>
<script src="/Relay.swift/8670f60a.3ae2b88d.js"></script>
</body>
</html>