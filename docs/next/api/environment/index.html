<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/Relay.swift/releases/rss.xml" title="Relay.swift Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/Relay.swift/releases/atom.xml" title="Relay.swift Blog Atom Feed"><title data-react-helmet="true">Environment | Relay.swift</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Environment | Relay.swift"><meta data-react-helmet="true" name="description" content="`swift"><meta data-react-helmet="true" property="og:description" content="`swift"><meta data-react-helmet="true" property="og:url" content="https://relay-tools.github.io/Relay.swift/docs/next/api/environment"><link data-react-helmet="true" rel="shortcut icon" href="/Relay.swift/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://relay-tools.github.io/Relay.swift/docs/next/api/environment"><link rel="stylesheet" href="/Relay.swift/styles.62dfcd7f.css">
<link rel="preload" href="/Relay.swift/styles.144f0b80.js" as="script">
<link rel="preload" href="/Relay.swift/runtime~main.1d8c9810.js" as="script">
<link rel="preload" href="/Relay.swift/main.d2f021be.js" as="script">
<link rel="preload" href="/Relay.swift/1.c8555c82.js" as="script">
<link rel="preload" href="/Relay.swift/2.97c26455.js" as="script">
<link rel="preload" href="/Relay.swift/87.b920650e.js" as="script">
<link rel="preload" href="/Relay.swift/88.a1cb33e6.js" as="script">
<link rel="preload" href="/Relay.swift/935f2afb.aefec6fc.js" as="script">
<link rel="preload" href="/Relay.swift/17896441.dd035e36.js" as="script">
<link rel="preload" href="/Relay.swift/2f44017d.34fc7cbd.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/Relay.swift/"><strong class="navbar__title">Relay.swift</strong></a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/Relay.swift/docs/next/">Next</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/Relay.swift/docs/next/api/environment">Next</a></li><li><a class="dropdown__link" href="/Relay.swift/docs/api/environment">1.0.0</a></li></ul></div><a class="navbar__item navbar__link" href="/Relay.swift/docs/knowledge-base">Knowledge base</a><a class="navbar__item navbar__link" href="/Relay.swift/releases/">Releases</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/relay-tools/Relay.swift" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/Relay.swift/"><strong class="navbar__title">Relay.swift</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a role="button" class="menu__link menu__link--sublist">Versions</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/Relay.swift/docs/next/api/environment">Next</a></li><li class="menu__list-item"><a class="menu__link" href="/Relay.swift/docs/api/environment">1.0.0</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/Relay.swift/docs/knowledge-base">Knowledge base</a></li><li class="menu__list-item"><a class="menu__link" href="/Relay.swift/releases/">Releases</a></li><li class="menu__list-item"><a href="https://github.com/relay-tools/Relay.swift" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/Relay.swift/docs/next/">Relay.swift</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Getting started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/next/getting-started/installation">Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/next/getting-started/relay-environment">The Relay environment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/next/getting-started/fetching-data">Fetching data with queries</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/next/getting-started/fragments">Composing views with fragments</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/next/getting-started/mutations">Making changes with mutations</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">API reference</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">Relay.swift</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Relay.swift/docs/next/api/intro-relay">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Relay.swift/docs/next/api/graphql">GraphQL tagged strings</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/Relay.swift/docs/next/api/environment">Environment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Relay.swift/docs/next/api/network">Network layer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Relay.swift/docs/next/api/store">Store</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Relay.swift/docs/next/api/record-source-selector-proxy">RecordSourceSelectorProxy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Relay.swift/docs/next/api/record-proxy">RecordProxy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Relay.swift/docs/next/api/connection-handler">ConnectionHandler</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Relay.swift/docs/next/api/mock-environment">MockEnvironment</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Relay in SwiftUI</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/next/api/intro-relay-swift-ui">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/next/api/relay-environment-modifier">relayEnvironment()</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/next/api/relay-environment-wrapper">@RelayEnvironment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/next/api/query">@Query</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/next/api/fragment">@Fragment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/next/api/refetchable-fragment">@RefetchableFragment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/next/api/pagination-fragment">@PaginationFragment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/next/api/mutation">@Mutation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/next/api/preview-payload">previewPayload()</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Development</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Relay.swift/docs/next/development/contributing">Contributing</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for Relay.swift <strong>Next</strong> version.</div><div class="margin-top--md">For up-to-date documentation, see the <strong><a href="/Relay.swift/docs/api/environment">latest version</a></strong> (1.0.0).</div></div><div class="docItemContainer_a7m4"><article><div><span class="badge badge--secondary">Version: Next</span></div><header><h1 class="docTitle_Oumm">Environment</h1></header><div class="markdown"><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-swift codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">class Environment</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The <code>Environment</code> combines all the things that Relay.swift needs to be able to work. You use an environment to fetch queries and load stored records. Any views in your app that need to use Relay will need access to the environment to do so.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="creating-an-environment"></a>Creating an environment<a class="hash-link" href="#creating-an-environment" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="init"></a><code>init</code><a class="hash-link" href="#init" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-swift codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">init(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    network: Network,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    store: Store,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    handlerProvider: HandlerProvider = DefaultHandlerProvider()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>An environment needs two things at a minimum:</p><ul><li>A <a href="/Relay.swift/docs/next/api/network">Network Layer</a> to tell it how to communicate with your GraphQL API</li><li>A <a href="/Relay.swift/docs/next/api/store">Store</a> for keeping track of data locally</li></ul><p>Once you&#x27;ve created it, you probably want to keep the same Environment instance for the lifetime of your app. In SwiftUI, you can use <a href="/Relay.swift/docs/next/api/relay-environment-modifier">relayEnvironment()</a> to provide this to your views.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="fetching-data-outside-a-view"></a>Fetching data outside a view<a class="hash-link" href="#fetching-data-outside-a-view" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="fetchquery"></a><code>fetchQuery</code><a class="hash-link" href="#fetchquery" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-swift codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">func fetchQuery&lt;Op: Operation&gt;(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    _ operation: Op,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    cacheConfig: CacheConfig = .init()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">) -&gt; AnyPublisher&lt;Op.Data?, Error&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The <code>fetchQuery</code> method allows you to perform a query without displaying the data in a view. Sometimes this can be useful to update the local store with new data in response to an event, or if you  need access to a query&#x27;s data in a background task.</p><p>If you want to show query data in a SwiftUI view, use the <a href="/Relay.swift/docs/next/api/query">@Query</a> property wrapper.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="running-mutations-outside-a-view"></a>Running mutations outside a view<a class="hash-link" href="#running-mutations-outside-a-view" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="commitmutation"></a><code>commitMutation</code><a class="hash-link" href="#commitmutation" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-swift codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">func commitMutation&lt;Op: Operation&gt;(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  _ operation: Op,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  optimisticResponse: [String: Any]? = nil,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  optimisticUpdater: SelectorStoreUpdater? = nil,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  updater: SelectorStoreUpdater? = nil</span></div><div class="token-line" style="color:#393A34"><span class="token plain">) -&gt; AnyPublisher&lt;Op.Data?, Error&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The <code>commitMutation</code> method allows you to execute a mutation to update data on the server. You can use this if you need to execute a mutation outside your views.</p><p>Note that you need to subscribe to the publisher that is returned (using <code>sink</code> or <code>assign</code>) in order for your mutation to actually execute, and if that subscription is canceled early for some reason, you may not see the updates you expect.</p><p>If you want to run a mutation in response to input from a SwiftUI view, use the <a href="/Relay.swift/docs/next/api/mutation">@Mutation</a> property wrapper, which manages this for you and makes it easy to show progress state in your UI while the mutation is running.</p><p>For more information about how to use the <code>updater</code> and <code>optimisticUpdater</code> parameters, see <a href="/Relay.swift/docs/next/knowledge-base/updater-functions">Updater functions</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="updating-the-store-manually"></a>Updating the store manually<a class="hash-link" href="#updating-the-store-manually" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="commitupdate_"></a><code>commitUpdate(_:)</code><a class="hash-link" href="#commitupdate_" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-swift codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">func commitUpdate(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    _ updater: @escaping StoreUpdater</span></div><div class="token-line" style="color:#393A34"><span class="token plain">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The <code>commitUpdate</code> method allows you to perform updates to Relay&#x27;s store outside the context of a mutation.</p><p>The main reason to do this is to add client-only data to the store. The <code>StoreUpdater</code> function you pass in is similar to the <code>SelectorStoreUpdater</code> used for mutations, but without the methods and arguments for information provided by the mutation&#x27;s response.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>We may document <code>Environment</code>&#x27;s other public methods at some point, but they&#x27;re largely there to implement higher-level APIs like <code>RelaySwiftUI</code>.</p></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/relay-tools/Relay.swift/edit/main/website/docs/api/environment.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/Relay.swift/docs/next/api/graphql"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« GraphQL tagged strings</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/Relay.swift/docs/next/api/network"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Network layer Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#creating-an-environment" class="table-of-contents__link">Creating an environment</a><ul><li><a href="#init" class="table-of-contents__link"><code>init</code></a></li></ul></li><li><a href="#fetching-data-outside-a-view" class="table-of-contents__link">Fetching data outside a view</a><ul><li><a href="#fetchquery" class="table-of-contents__link"><code>fetchQuery</code></a></li></ul></li><li><a href="#running-mutations-outside-a-view" class="table-of-contents__link">Running mutations outside a view</a><ul><li><a href="#commitmutation" class="table-of-contents__link"><code>commitMutation</code></a></li></ul></li><li><a href="#updating-the-store-manually" class="table-of-contents__link">Updating the store manually</a><ul><li><a href="#commitupdate_" class="table-of-contents__link"><code>commitUpdate(_:)</code></a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Matt Moriarity.</div></div></div></footer></div>
<script src="/Relay.swift/styles.144f0b80.js"></script>
<script src="/Relay.swift/runtime~main.1d8c9810.js"></script>
<script src="/Relay.swift/main.d2f021be.js"></script>
<script src="/Relay.swift/1.c8555c82.js"></script>
<script src="/Relay.swift/2.97c26455.js"></script>
<script src="/Relay.swift/87.b920650e.js"></script>
<script src="/Relay.swift/88.a1cb33e6.js"></script>
<script src="/Relay.swift/935f2afb.aefec6fc.js"></script>
<script src="/Relay.swift/17896441.dd035e36.js"></script>
<script src="/Relay.swift/2f44017d.34fc7cbd.js"></script>
</body>
</html>